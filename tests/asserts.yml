# Check that the system is properly provisioned
---
- stat:
    path: /var/awslogs/etc/aws.conf
  register: _conf

- stat:
    path: /var/awslogs/etc/awslogs.conf
  register: _logsconf

- name: aws.conf exists
  assert:
    that: _conf.stat.exists == true

- name: awslogs.conf exists
  assert:
    that: _logsconf.stat.exists == true

- command: grep region /var/awslogs/etc/aws.conf
  register: _conf

- name: region is correct in aws.conf
  assert:
    that: _conf.stdout == 'region = us-east-1'

- command: grep NLM-INT-var-log-messages /var/awslogs/etc/awslogs.conf
  register: _logsconf

- name: nlmaccount appears correctly in awslogs.conf
  assert:
    that: _logsconf.stdout == 'log_group_name = NLM-INT-var-log-messages'

- shell: grep groot /var/awslogs/etc/awslogs.conf | wc -l
  register: _logsconf
  
- name: nametag appears correctly in awslogs.conf
  assert:
    that: _logsconf.stdout == '3'
